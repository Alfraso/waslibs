<p>Today we released a major set of updates to Microsoft Azure. Today’s updates include: <ul> <li><strong>DocumentDB</strong>: Preview of a New NoSQL Document Service for Azure <li><strong>Search</strong>: Preview of a New Search-as-a-Service offering for Azure <li><strong>Virtual Machines</strong>: Portal support for SQL Server AlwaysOn + community-driven VMs <li><strong>Web Sites</strong>: Support for Web Jobs and Web Site processes in the Preview Portal <li><strong>Azure Insights</strong>: General Availability of Microsoft Azure Monitoring Services Management Library <li><strong>API Management</strong>: Support for API Management REST APIs</li></ul> <p>All of these improvements are now available to use immediately (note that some features are still in preview).&nbsp; Below are more details about them: <h2><u>DocumentDB: Announcing a New NoSQL Document Service for Azure</u></h2> <p>I’m excited to announce the preview of our new DocumentDB service - a NoSQL document database service designed for scalable and high performance modern applications.&nbsp; DocumentDB is delivered as a fully managed service (meaning you don’t have to manage any infrastructure or VMs yourself) with an enterprise grade SLA. <p>As a NoSQL store, DocumentDB is truly schema-free. It allows you to store and query any JSON document, regardless of schema. The service provides built-in automatic indexing support – which means you can write JSON documents to the store and immediately query them using a familiar document oriented SQL query grammar. You can optionally extend the query grammar to perform service side evaluation of user defined functions (UDFs) written in server-side JavaScript as well.&nbsp; <p>DocumentDB is designed to linearly scale to meet the needs of your application. The DocumentDB service is purchased in capacity units, each offering a reservation of high performance storage and dedicated performance throughput. Capacity units can be easily added or removed via the Azure portal or REST based management API based on your scale needs. This allows you to elastically scale databases in fine grained increments with predictable performance and no application downtime simply by increasing or decreasing capacity units. <p>Over the last year, we have used DocumentDB internally within Microsoft for several high-profile services.&nbsp; We now have DocumentDB databases that are each 100s of TBs in size, each processing millions of complex DocumentDB queries per day, with predictable performance of low single digit ms latency.&nbsp; DocumentDB provides a great way to scale applications and solutions like this to an incredible size. <p>DocumentDB also enables you to tune performance further by customizing the index policies and consistency levels you want for a particular application or scenario, making it an incredibly flexible and powerful data service for your applications.&nbsp;&nbsp; For queries and read operations, DocumentDB offers four distinct consistency levels - Strong, Bounded Staleness, Session, and Eventual. These consistency levels allow you to make sound tradeoffs between consistency and performance. Each consistency level is backed by a predictable performance level ensuring you can achieve reliable results for your application. <p>DocumentDB has made a significant bet on ubiquitous formats like JSON, HTTP and REST – which makes it easy to start taking advantage of from any Web or Mobile applications.&nbsp; With today’s release we are also distributing .NET, Node.js, JavaScript and Python SDKs.&nbsp; The service can also be accessed through RESTful HTTP interfaces and is simple to manage through the Azure preview portal. <h3><u>Provisioning a DocumentDB account</u></h3> <p>To get started with DocumentDB you provision a new database account. To do this, use the new Azure Preview Portal (<a href="http://portal.azure.com">http://portal.azure.com</a>), click the Azure gallery and select the <b>Data, storage, cache + backup</b> category, and locate the <b>DocumentDB </b>gallery item. <p><a href="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_2.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_thumb.png" width="850" height="503"></a> <p>Once you select the DocumentDB item, choose the Create command to bring up the Create blade for it.</p> <p>In the create blade, specify the name of the service you wish to create, the amount of capacity you wish to scale your DocumentDB instance to, and the location around the world that you want to deploy it (e.g. the West US Azure region): <p><a href="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_4.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_thumb_1.png" width="170" height="401"></a> </p> <p>Once provisioning is complete, you can start to manage your DocumentDB account by clicking the new instance icon on your Azure portal dashboard.&nbsp; <p><a href="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_6.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_thumb_2.png" width="275" height="181"></a> <p>The keys tile can be used to retrieve the security keys to use to access the DocumentDB service programmatically. <h3><u>Developing with DocumentDB</u></h3> <p>DocumentDB provides a number of different ways to program against it. You can use the REST API directly over HTTPS, or you can choose from either the .NET, Node.js, JavaScript or Python client SDKs. <p>The JSON data I am going to use for this example are two families: <p></p> <blockquote> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">// AndersonFamily.json file</span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">{<?xml namespace prefix="o" ?>
<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"id"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"AndersenFamily"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"lastName"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Andersen"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"parents"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: [<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{ </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"firstName"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Thomas"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> },<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{ </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"firstName"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Mary Kay"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> }<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>],<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"children"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: [<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{ </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"firstName"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"John"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"gender"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"male"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"grade"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: 7 }<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>],<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"pets"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: [<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{ </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"givenName"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Fluffy"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> }<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>],<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"address"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: { </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"country"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"USA"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"state"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"WA"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"city"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Seattle"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> }<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">}<o:p></o:p></span></p></blockquote> <p>and</p> <blockquote> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">// WakefieldFamily.json file</span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">{<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"id"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"WakefieldFamily"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"parents"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: [<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{ </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"familyName"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Wakefield"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"givenName"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Robin"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> },<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{ </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"familyName"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Miller"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"givenName"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Ben"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> }<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>],<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"children"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: [<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"familyName"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Wakefield"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"givenName"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Jesse"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"gender"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"female"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"grade"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: 1<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>},<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"familyName"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Miller"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"givenName"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Lisa"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"gender"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"female"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"grade"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: 8<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>],<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"pets"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: [<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{ </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"givenName"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Goofy"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> },<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{ </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"givenName"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Shadow"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> }<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>],<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"address"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: { </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"country"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"USA"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"state"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"NY"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"county"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Manhattan"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2e75b6; mso-highlight: white">"city"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">: </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"NY"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> }<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">}<o:p></o:p></span></p></blockquote> <p>Using the NuGet package manager in Visual Studio, I can search for and install the DocumentDB .NET package into any .NET application. With the URI and Authentication Keys for the DocumentDB service that I retrieved earlier from the Azure Management portal, I can then connect to the DocumentDB service I just provisioned, create a Database, create a Collection, Insert some JSON documents and immediately start querying for them: <p></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">using</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> (client = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> DocumentClient(</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> Uri(endpoint), authKey))<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">{<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">var</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> database = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> Database { Id = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"ScottsDemoDB"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> };<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>database = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">await</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> client.CreateDatabaseAsync(database);<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">var</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> collection = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> DocumentCollection { Id = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Families"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> };<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>collection = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">await</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> client.CreateDocumentCollectionAsync(database.SelfLink, collection);<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: green; mso-highlight: white">//DocumentDB supports strongly typed POCO objects and also dynamic objects</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">dynamic</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> andersonFamily =<span style="mso-spacerun: yes">&nbsp; </span>JsonConvert.DeserializeObject(</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white">File</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">.ReadAllText(</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">@".\Data\AndersonFamily.json"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">));<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">dynamic</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> wakefieldFamily = JsonConvert.DeserializeObject(</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white">File</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">.ReadAllText(</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">@".\Data\WakefieldFamily.json"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">));<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: green; mso-highlight: white">//persist the documents in DocumentDB</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">await</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> client.CreateDocumentAsync(collection.SelfLink, andersonFamily);<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">await</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> client.CreateDocumentAsync(collection.SelfLink, wakefieldFamily);<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: green; mso-highlight: white">//very simple query returning the full JSON document matching a simple WHERE clause </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">var</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> query = client.CreateDocumentQuery(collection.SelfLink, </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"SELECT * FROM Families f WHERE f.id = 'AndersenFamily'"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">);<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">var</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> family = query.AsEnumerable().FirstOrDefault();<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white">Console</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">.WriteLine(</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"The Anderson family have the following pets:"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">);<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">foreach</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> (</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">var</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> pet </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">in</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> family.pets)<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>{<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white">Console</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">.WriteLine(pet.givenName);<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: green; mso-highlight: white">//select JUST the child record out of the Family record where the child's gender is male</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>query = client.CreateDocumentQuery(collection.DocumentsLink, </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"SELECT * FROM c IN Families.children WHERE c.gender='male'"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">);<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">var</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> child = query.AsEnumerable().FirstOrDefault();<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white">Console</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">.WriteLine(</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"The Andersons have a son named {0} in grade {1} "</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, child.firstName, child.grade);<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: green; mso-highlight: white">//cleanup test database</span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">await</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> client.DeleteDatabaseAsync(database.SelfLink);<o:p></o:p></span></p> <p class="MsoNormal"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; line-height: 107%; mso-highlight: white">}</span></p> <p>As you can see above – the .NET API for DocumentDB fully supports the .NET async pattern, which makes it ideal for use with applications you want to scale well.&nbsp; </p> <h3><u>Server-side JavaScript Stored Procedures</u></h3> <p>If I wanted to perform some updates affecting multiple documents within a transaction, I can define a stored procedure using JavaScript that swapped pets between families. In this scenario it would be important to ensure that one family didn’t end up with all the pets and another ended up with none due to something unexpected happening. Therefore if an error occurred during the swap process, it would be crucial that the database rollback the transaction and leave things in a consistent state.&nbsp; I can do this with the following stored procedure that I run within the DocumentDB service: <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">function</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> SwapPets(family1Id, family2Id) {<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">var</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> context = getContext();<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">var</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> collection = context.getCollection();<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">var</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> response = context.getResponse();<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>collection.queryDocuments(collection.getSelfLink(), </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">'SELECT * FROM Families f where f.id<span style="mso-spacerun: yes">&nbsp; </span>= "'</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> + family1Id + </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">'"'</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, {},<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">function</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> (err, documents, responseOptions) {<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">var</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> family1 = documents[0];<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>collection.queryDocuments(collection.getSelfLink(), </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">'SELECT * FROM Families f where f.id = "'</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> + family2Id + </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">'"'</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, {},<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">function</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> (err2, documents2, responseOptions2) {<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun: yes">&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">var</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> family2 = documents2[0];<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">var</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> itemSave = family1.pets;<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>family1.pets = family2.pets;<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>family2.pets = itemSave;<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>collection.replaceDocument(family1._self, family1,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">function</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> (err, docReplaced) { <o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>collection.replaceDocument(family2._self, family2, {});<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>});<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>response.setBody(</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">true</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">);<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>});<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>});<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">}<o:p></o:p></span></p> <p class="MsoNormal"><o:p>&nbsp;</o:p></p> <p>If an exception is thrown in the JavaScript function due to for instance a concurrency violation when updating a record, the transaction is reversed and system is returned to the state it was in before the function began. <p>It’s easy to register the stored procedure in code like below (for example: in a deployment script or app startup code): <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: green; mso-highlight: white">//register a stored procedure</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>StoredProcedure storedProcedure = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> StoredProcedure<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>{<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Id = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"SwapPets"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, <o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Body = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white">File</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">.ReadAllText(</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">@".\JS\SwapPets.js"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">)<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>};<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><o:p></o:p></span></p> <p class="MsoNormal"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; line-height: 107%; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>storedProcedure = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; line-height: 107%; mso-highlight: white">await</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; line-height: 107%; mso-highlight: white"> client.CreateStoredProcedureAsync(collection.SelfLink, storedProcedure);</span></p> <p class="MsoNormal"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; line-height: 107%; mso-highlight: white"></span>&nbsp;</p> <p>And just as easy to execute the stored procedure from within your application: <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: green; mso-highlight: white">//execute stored procedure passing in the two family documents involved in the pet swap<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">dynamic</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> result = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">await</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> client.ExecuteStoredProcedureAsync&lt;</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">dynamic</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">&gt;(storedProcedure.SelfLink, </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"AndersenFamily"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"WakefieldFamily"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">);</span></p> <p>If we checked the pets now linked to the Anderson Family we’d see they have been swapped. <h3><u>Learning More</u></h3> <p>It’s really easy to get started with DocumentDB and create a simple working application in a couple of minutes.&nbsp; The above was but one simple example of how to start using it.&nbsp; Because DocumentDB is schema-less you can use it with literally any JSON document.&nbsp; Because it performs automatic indexing on every JSON document stored within it, you get screaming performance when querying those JSON documents later. Because it scales linearly with consistent performance, it is ideal for applications you think might get large. <p>You can learn more about DocumentDB from the new DocumentDB development center <a href="http://azure.microsoft.com/en-us/services/documentdb/" target="_blank">here</a>. <p></p> <p></p> <h2><u>Search: Announcing preview of new Search as a Service for Azure</u></h2> <p>I’m excited to announce the preview of our new Azure Search service.&nbsp; Azure Search makes it easy for developers to add great search experiences to any web or mobile application.&nbsp;&nbsp;&nbsp; <p>Azure Search provides developers with all of the features needed to build out their search experience without having to deal with the typical complexities that come with managing, tuning and scaling a real-world search service.&nbsp; It is delivered as a fully managed service with an enterprise grade SLA.&nbsp; We also are releasing a Free tier of the service today that enables you to use it with small-scale solutions on Azure at no cost. <h3><u>Provisioning a Search Service</u></h3> <p>To get started, let’s create a new search service.&nbsp; In the Azure Preview Portal (<a href="http://portal.azure.com">http://portal.azure.com</a>), navigate to the Azure Gallery, and choose the <b>Data storage, cache + backup</b> category, and locate the Azure Search gallery item. <p><a href="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_42.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_thumb_20.png" width="824" height="647"></a> </p> <p>Locate the “Search” service icon and select <b>Create</b> to create an instance of the service: <p><a href="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_20.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_thumb_9.png" width="624" height="403"></a> <p>You can choose from two Pricing Tier options: <b>Standard</b> which provides dedicated capacity for your search service, and a <b>Free</b> option that allows every Azure subscription to get a free small search service in a shared environment. <p>The standard tier can be easily scaled up or down and provides dedicated capacity guarantees to ensure that search performance is predictable for your application.&nbsp; It also supports the ability to index 10s of millions of documents with lots of indexes. <p>The free tier is limited to 10,000 documents, up to 3 indexes and has no dedicated capacity guarantees. However it is also totally free, and also provides a great way to learn and experiment with all of the features of Azure Search. <h3><u>Managing your Azure Search service</u></h3> <p>After provisioning your Search service, you will land in the Search blade within the portal - which allows you to manage the service, view usage data and tune the performance of the service: <p><a href="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_22.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_thumb_10.png" width="444" height="584"></a> <p>I can click on the <b>Scale</b> tile above to bring up the details of the number of resources allocated to my search service. If I had created a Standard search service, I could use this to increase the number of replicas allocated to my service to support more searches per second (or to provide higher availability) and the number of partitions to give me support for higher numbers of documents within my search service. <h3><u>Creating a Search Index</u></h3> <p>Now that the search service is created, I need to create a search index that will hold the documents (data) that will be searched. To get started, I need two pieces of information from the Azure Portal, the service URL to access my Azure Search service (accessed via the <strong>Properties </strong>tile) and the Admin Key to authenticate against the service (accessed via the <strong>Keys </strong>title). <p><a href="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_24.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_thumb_11.png" width="624" height="260"></a> <p></p> <p>Using this search service URL and admin key, I can start using the search service APIs to create an index and later upload data and issue search requests. I will be sending HTTP requests against the API using that key, so I’ll setup a .NET HttpClient object to do this as follows: <blockquote> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white">HttpClient</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> client = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white">HttpClient</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">();<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">client.DefaultRequestHeaders.Add(</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"api-key"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"19F1BACDCD154F4D3918504CBF24CA1F"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">);</span><o:p></o:p></p></blockquote> <p>I’ll start by creating the search index. In this case I want an index I can use to search for contacts in my dataset, so I want searchable fields for their names and tags; I also want to track the last contact date (so I can filter or sort on that later on) and their address as a lat/long location so I can use it in filters as well. To make things easy I will be using JSON.NET (to do this, add the NuGet package to your VS project) to serialize objects to JSON. <blockquote> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">var</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> index = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">{<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>name = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"contacts"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>fields = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">[] <o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>{ <o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> { name = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"id"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, type = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Edm.String"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, key = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">true</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> },<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> { name = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"fullname"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, type = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Edm.String"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, key = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">false</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> },<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> { name = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"tags"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, type = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Collection(Edm.String)"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, key = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">false</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> },<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> { name = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"lastcontacted"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, type = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Edm.DateTimeOffset"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, key = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">false</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> },<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> { name = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"worklocation"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, type = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Edm.GeographyPoint"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, key = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">false</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> },<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span lang="ES-AR" style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-ansi-language: es-ar">}<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span lang="ES-AR" style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-ansi-language: es-ar">};<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span lang="ES-AR" style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-ansi-language: es-ar"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span lang="ES-AR" style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white; mso-ansi-language: es-ar">var</span><span lang="ES-AR" style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-ansi-language: es-ar"> response = client.PostAsync(</span><span lang="ES-AR" style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white; mso-ansi-language: es-ar">"https://scottgu-dev.search.windows.net/indexes/?api-version=2014-07-31-Preview"</span><span lang="ES-AR" style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-ansi-language: es-ar">,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span lang="ES-AR" style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-ansi-language: es-ar"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white">StringContent</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">(</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white">JsonConvert</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">.SerializeObject(index), </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white">Encoding</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">.UTF8, </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"application/json"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">)).Result;<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">response.EnsureSuccessStatusCode();<o:p></o:p></span></p></blockquote> <p>You can run this code as part of your deployment code or as part of application initialization. <h3><u>Populating a Search Index</u></h3> <p>Azure Search uses a push API for indexing data. You can call this API with batches of up to 1000 documents to be indexed at a time. Since it’s your code that pushes data into the index, the original data may be anywhere: in a SQL Database in Azure, DocumentDb database, blob/table storage, etc.&nbsp; You can even populate it with data stored on-premises or in a non-Azure cloud provider. <p>Note that indexing is rarely a one-time operation. You will probably have an initial set of data to load from your data source, but then you will want to push new documents as well as update and delete existing ones. If you use Azure Websites, this is a natural scenario for <a href="http://azure.microsoft.com/en-us/documentation/articles/web-sites-create-web-jobs/">Webjobs</a> that can run your indexing code regularly in the background. <p>Regardless of where you host it, the code to index data needs to pull data from the source and push it into Azure Search. In the example below I’m just making up data, but you can see how I could be using the result of a SQL or LINQ query or anything that produces a set of objects that match the index fields we identified above. <blockquote> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">var</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> batch = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">{<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>value = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">[] <o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>{ <o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> <o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{ <o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>id = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"221"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>fullname = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Jay Adams"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>tags = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">string</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">[] { </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"work"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> },<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>lastcontacted = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white">DateTimeOffset</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">.UtcNow,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>worklocation = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>type = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Point"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>coordinates = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> [] { -122.131577, 47.678581 }<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>},<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> <o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{ <o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>id = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"714"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>fullname = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Catherine Abel"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, <o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>tags = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">string</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">[] { </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"work"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">, </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"personal"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> },<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>lastcontacted = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white">DateTimeOffset</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">.UtcNow,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp; </span><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>worklocation = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>type = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"Point"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>coordinates = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> [] { -121.825579, 47.1419814}<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">};<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">var</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> response = client.PostAsync(</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"https://scottgu-dev.search.windows.net/indexes/contacts/docs/index?api-version=2014-07-31-Preview"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white">StringContent</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">(</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white">JsonConvert</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">.SerializeObject(batch), </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white">Encoding</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">.UTF8, </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"application/json"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">)).Result;<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">response.EnsureSuccessStatusCode();<o:p></o:p></span></p></blockquote> <h3><u>Searching an Index</u></h3> <p>After creating an index and populating it with data, I can now issue search requests against the index. Searches are simple HTTP GET requests against the index, and responses contain the data we originally uploaded as well as accompanying scoring information. <p>I can do a simple search by executing the code below, where searchText is a string containing the user input, something like <i>abel work</i> for example: <blockquote> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span lang="ES-AR" style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white; mso-ansi-language: es-ar">var</span><span lang="ES-AR" style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-ansi-language: es-ar"> response = client.GetAsync(</span><span lang="ES-AR" style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white; mso-ansi-language: es-ar">"https://scottgu-dev.search.windows.net/indexes/contacts/docs?api-version=2014-07-31-Preview&amp;search="</span><span lang="ES-AR" style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-ansi-language: es-ar"> + </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white">Uri</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">.EscapeDataString(searchText)).Result;<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">response.EnsureSuccessStatusCode();<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">dynamic</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> results = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white">JsonConvert</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">.DeserializeObject(response.Content.ReadAsStringAsync().Result);<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">foreach</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> (</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">var</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> result </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">in</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"> results.value)<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">{<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>Console.WriteLine(<span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"FullName:</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">" + </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">result.fullname + <span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">" </span>score:<span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"</span> + (</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white">double</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">)result[</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white">"@search.score"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">]);<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white">}<o:p></o:p></span></p></blockquote> <h3><u>Learning More</u></h3> <p>The above is just a simple scenario of what you can do.&nbsp; There are a lot of other things we could do with searches. For example, I can use query string options to filter, sort, project and page over the results. I can use hit-highlighting and faceting to create a richer way to navigate results and suggestions to implement auto-complete within my web or mobile UI. <p>In this example, I used the default ranking model, which uses statistics of the indexed text and search string to compute scores. You can also author your own scoring profiles that model scores in ways that match the needs of your application. <p>Check out the <a href="http://go.microsoft.com/fwlink/?LinkID=397746&amp;clcid=0x409">Azure Search documentation</a> for more details on how to get started, and some of the more advanced use-cases you can take advantage of.&nbsp; With the free tier now available at no cost to every Azure subscriber, there is no longer any reason not to have Search fully integrated within your applications. <h2><u>Virtual Machines: Support for SQL Server AlwaysOn, VM Depot images</u></h2> <p>Last month we added support for managing VMs within the Azure Preview Portal (<a href="http://portal.azure.com">http://portal.azure.com</a>).&nbsp; We also released built-in portal support that enables you to easily create multi-VM SharePoint Server Farms as well as a slew of additional Azure Certified VM images.&nbsp; You can learn more about these updates in <a href="http://weblogs.asp.net/scottgu/azure-virtual-machine-machine-learning-iot-event-ingestion-mobile-sql-redis-sdk-improvements" target="_blank">my last blog post</a>. <p>Today, I’m excited to announce new support for automatically deploying SQL Server VMs with AlwaysOn configured, as well as integrated portal support for community supported VM Depot images. <h3><u>SQL Server AlwaysOn Template</u></h3> <p>AlwaysOn Availability Groups<a href="http://technet.microsoft.com/en-us/library/hh510230.aspx"></a>, released in SQL Server 2012 and enhanced in SQL Server 2014, guarantee high availability for mission-critical workloads. Last year we started supporting <a href="http://weblogs.asp.net/scottgu/windows-azure-general-availability-of-sql-server-always-on-support-and-notification-hubs-autoscale-improvements-more">SQL Availability Groups on Azure Infrastructure Services</a>. In such a configuration, two SQL replicas (primary and secondary), each in its own Azure VM, are configured for automatic failover, and a <a href="http://msdn.microsoft.com/en-us/library/hh213417.aspx">listener</a> (DNS name) is configured for client connectivity. Other components required are a file share witness to guarantee quorum in the configuration to avoid “split brain” scenarios, and a domain controller to join all VMs to the same domain. The SQL as well as the domain controller replicas are each deployed to an availability set to ensure they are in different Azure failure and upgrade domains. <p>Prior to today’s release, setting up the <a href="http://msdn.microsoft.com/en-us/library/dn249504.aspx">Availability Group configuration</a> could be tedious and time consuming. We have dramatically simplified this experience through a new SQL Server AlwaysOn template in the Azure Gallery. This template fully automates the configuration of a highly available SQL Server deployment on Azure Infrastructure Services using an Availability Group. <p>You can find the template by navigating to the Azure Gallery within the Azure Preview Portal (<a href="http://portal.azure.com">http://portal.azure.com</a>), selecting the Virtual Machine category on the left and selecting the <b>SQL Server 2014 AlwaysOn</b> gallery item. In the gallery details page, select <b>Create</b>. All you need is to provide some basic configuration information such as the administrator credentials for the VMs and the rest of the settings are defaulted for you. You may consider changing the defaults for <i>Listener </i>name as this is what your applications will use to connect to SQL Server. <p><a href="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_36.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_thumb_17.png" width="624" height="745"></a> <p>Upon creation, 5 VMs are created in the resource group: 2 VMs for the SQL Server replicas, 2 VMs for the Domain Controller replicas, and 1 VM for the file share witness. <p>Once created, you can RDP to one of the SQL Server VMs to see the Availability Group configuration as depicted below: <p><a href="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_38.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_thumb_18.png" width="624" height="285"></a> <p>Try out the SQL Server AlwaysOn template in the <a href="https://portal.azure.com/">Azure Preview Portal</a> today and give us your feedback! <h3><u>VM Depot in Azure Gallery</u></h3> <p>Community-driven VM Depot images have been supported on the Azure platform for a couple of years now. But prior to today’s release they weren’t fully integrated into the mainline user experience. <p>Today, I’m excited to announce that we have integrated community VMs&nbsp; into the Azure Preview Portal and the Azure gallery. With this release, you will find close to 300 pre-configured Virtual Machine images for Microsoft Azure. <p>Using these images, fully functional Virtual Machines can be deployed in the Preview Portal in minutes and customized for specific use cases. Starting from base operating system distributions (such as Debian, Ubuntu, CentOS, Suse and FreeBSD) through developer stacks (such as LAMP, Ruby on Rails, Node and Django), to complete applications (such as Wordpress, Drupal and Apache Solr), there is something for everyone in VM Depot. <p>Try out the VM Depot images in the Azure gallery from within the Virtual Machine category. <h2><a href="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_40.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_thumb_19.png" width="882" height="816"></a> </h2> <h2><u>Web Sites: WebJobs and Process Management in the Preview Portal</u></h2> <p>Starting with today’s Azure release, Web Site WebJobs are now supported in the <a href="https://portal.azure.com/">Azure Preview Portal.</a>&nbsp; You can also now drill into your Web Sites and monitor the health of any processes running within them (both to host your web code as well as your web jobs). <h3><u>Web Site WebJobs</u></h3> <p>Using WebJobs, you can now now run any code within your Azure Web Sites – and do so in a way that is readily parallelizable, globally scalable, and complete with remote debugging, full VS support and an optional SDK to facilitate authoring. For more information about the power of WebJobs, visit <a href="http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/azure-webjobs-recommended-resources">Azure WebJobs recommended resources.</a> <p>With today’s Azure release, we now support two types of Webjobs: on Demand and Continuous.&nbsp; To use WebJobs in the preview portal, navigate to your web site and select the WebJobs tile within the Web Site blade. Notice that the part also now shows the count of WebJobs available. <p><a href="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_30.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_thumb_14.png" width="685" height="386"></a></p> <p>By drilling into the title, you can view existing WebJobs as well as create new OnDemand or Continuous WebJobs. Scheduled WebJobs are not yet supported in the preview portal, but expect to see this in the near future. <h3><u>Web Site Processes</u></h3> <p>I’m excited to announce a new feature in the Azure Web Sites experience in the Preview Portal - <b>Websites Processes</b>. Using <b>Websites Process </b>you can enumerate the different instances of your site, browse through the different processes on each instance, and even drill down to the handles and modules associated with each process. You can then check for detailed information like version, language and more. <p><a href="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_32.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_thumb_15.png" width="700" height="393"></a> <p>In addition, you also get rich monitoring for CPU, Working Set and Thread count at the process level.&nbsp; Just like with Task Manager for Windows, data collection begins when you open the <b>Websites Processes </b>blade, and stops when you close it. <p><a href="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_34.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_thumb_16.png" width="699" height="393"></a> <p>This feature is especially useful when your site has been scaled out and is misbehaving in some specific instances but not in others. You can quickly identify runaway processes, find open file handles, and even kill a specific process instance. <h2><u>Monitoring and Management SDK: Programmatic Access to Monitoring Data </u></h2> <p>The Azure Management Portal provides built-in monitoring and management support that makes it easy for you to track the health of your applications and solutions deployed within Azure. <p>If you want to programmatically access monitoring and management features in Azure, you can also now use our <a href="http://www.nuget.org/packages/Microsoft.WindowsAzure.Management.Monitoring">.NET SDK from Nuget</a>. We are releasing this SDK to general availability today, so you can now use it for your production services! <p>For example, if you want to build your own custom dashboard that shows metric data from across your services, you can get that metric data via the SDK: <blockquote> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: green; mso-highlight: white; mso-no-proof: yes">// Create the metrics client by obtain the certificate with the specified thumbprint.</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white; mso-no-proof: yes">MetricsClient</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"> metricsClient = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white; mso-no-proof: yes">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"> </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white; mso-no-proof: yes">MetricsClient</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">(</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white; mso-no-proof: yes">new</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"> </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white; mso-no-proof: yes">CertificateCloudCredentials</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">(SubscriptionId, GetStoreCertificate(Thumbprint)));<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: green; mso-highlight: white; mso-no-proof: yes">// Build the resource ID string.</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white; mso-no-proof: yes">string</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"> resourceId = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white; mso-no-proof: yes">ResourceIdBuilder</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">.BuildWebSiteResourceId(</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white; mso-no-proof: yes">"webtest-group-WestUSwebspace"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">, </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white; mso-no-proof: yes">"webtests-site"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">);<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: green; mso-highlight: white; mso-no-proof: yes">// Get the metric definitions.</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white; mso-no-proof: yes">MetricDefinitionCollection</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"> metricDefinitions = metricsClient.MetricDefinitions.List(resourceId, </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white; mso-no-proof: yes">null</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">, </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white; mso-no-proof: yes">null</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">).MetricDefinitionCollection;<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: green; mso-highlight: white; mso-no-proof: yes">// Display the available metric definitions.</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white; mso-no-proof: yes">Console</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">.WriteLine(</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white; mso-no-proof: yes">"Choose metrics (comma separated) to list:"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">);<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white; mso-no-proof: yes">int</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"> count = 0;<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white; mso-no-proof: yes">foreach</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"> (</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white; mso-no-proof: yes">MetricDefinition</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"> metricDefinition </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white; mso-no-proof: yes">in</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"> metricDefinitions.Value)<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">{<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white; mso-no-proof: yes">Console</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">.WriteLine(count + </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white; mso-no-proof: yes">":"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"> + metricDefinition.DisplayName);<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>count++;<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">}<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: green; mso-highlight: white; mso-no-proof: yes">// Ask the user which metrics they are interested in.</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white; mso-no-proof: yes">var</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"> desiredMetrics = </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white; mso-no-proof: yes">Console</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">.ReadLine().Split(</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white; mso-no-proof: yes">','</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">).Select(x =&gt;<span style="mso-spacerun: yes">&nbsp; </span>metricDefinitions.Value.ToArray()[</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white; mso-no-proof: yes">Convert</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">.ToInt32(x.Trim())]);<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: green; mso-highlight: white; mso-no-proof: yes">// Get the metric values for the last 20 minutes.</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white; mso-no-proof: yes">MetricValueSetCollection</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"> values = metricsClient.MetricValues.List(<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>resourceId,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>desiredMetrics.Select(x =&gt; x.Name).ToList(),<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white; mso-no-proof: yes">""</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">,<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>desiredMetrics.First().MetricAvailabilities.Select(x =&gt; x.TimeGrain).Min(),<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white; mso-no-proof: yes">DateTime</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">.UtcNow - </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white; mso-no-proof: yes">TimeSpan</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">.FromMinutes(20),<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white; mso-no-proof: yes">DateTime</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">.UtcNow<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">).MetricValueSetCollection;<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: green; mso-highlight: white; mso-no-proof: yes">// Display the metric values to the user.</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white; mso-no-proof: yes">foreach</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"> (</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white; mso-no-proof: yes">MetricValueSet</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"> valueSet </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white; mso-no-proof: yes">in</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"> values.Value )<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">{<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white; mso-no-proof: yes">Console</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">.WriteLine(valueSet.DisplayName + </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white; mso-no-proof: yes">" for the past 20 minutes:"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">);<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white; mso-no-proof: yes">foreach</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"> (</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white; mso-no-proof: yes">MetricValue</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"> metricValue </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: blue; mso-highlight: white; mso-no-proof: yes">in</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"> valueSet.MetricValues)<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>{<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white; mso-no-proof: yes">Console</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">.WriteLine(metricValue.Timestamp + </span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white; mso-no-proof: yes">"\t"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"> + metricValue.Average);<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">}<o:p></o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p> <p class="MsoNormal" style="margin-bottom: 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; mso-highlight: white; mso-no-proof: yes">Console</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">.Write(</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #a31515; mso-highlight: white; mso-no-proof: yes">"Press any key to continue:"</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; mso-highlight: white; mso-no-proof: yes">);<o:p></o:p></span></p> <p class="MsoNormal"><span style="font-size: 9.5pt; font-family: consolas; background: white; color: #2b91af; line-height: 107%; mso-highlight: white; mso-no-proof: yes">Console</span><span style="font-size: 9.5pt; font-family: consolas; background: white; color: black; line-height: 107%; mso-highlight: white; mso-no-proof: yes">.ReadKey();</span><span style="mso-no-proof: yes"><o:p></o:p></span></p></blockquote> <p>We support metrics for a variety of services with the monitoring SDK:</p> <table cellspacing="0" cellpadding="0" border="1"> <tbody> <tr> <td valign="top" width="312"> <p><b>Service</b></p></td> <td valign="top" width="312"> <p><b>Typical metrics</b></p></td> <td valign="top" width="312"> <p><b>Frequencies</b></p></td></tr> <tr> <td valign="top" width="312"> <p><b>Cloud services</b></p></td> <td valign="top" width="312"> <p>CPU, Network, Disk</p></td> <td valign="top" width="312"> <p>5 min, 1 hr, 12 hrs</p></td></tr> <tr> <td valign="top" width="312"> <p><b>Virtual machines</b></p></td> <td valign="top" width="312"> <p>CPU, Network, Disk</p></td> <td valign="top" width="312"> <p>5 min, 1 hr, 12 hrs</p></td></tr> <tr> <td valign="top" width="312"> <p><b>Websites</b></p></td> <td valign="top" width="312"> <p>Requests, Errors, Memory, Response time, Data out</p></td> <td valign="top" width="312"> <p>1 min, 1 hr</p></td></tr> <tr> <td valign="top" width="312"> <p><b>Mobile Services</b></p></td> <td valign="top" width="312"> <p>API Calls, Data Out, SQL performance</p></td> <td valign="top" width="312"> <p>1 hr</p></td></tr> <tr> <td valign="top" width="312"> <p><b>Storage</b></p></td> <td valign="top" width="312"> <p>Requests, Success rate, End2End latency</p></td> <td valign="top" width="312"> <p>1 min, 1 hr</p></td></tr> <tr> <td valign="top" width="312"> <p><b>Service Bus</b></p></td> <td valign="top" width="312"> <p>Messages, Errors, Queue length, Requests</p></td> <td valign="top" width="312"> <p>5 min</p></td></tr> <tr> <td valign="top" width="312"> <p><b>HDInsight</b></p></td> <td valign="top" width="312"> <p>Containers, Apps running</p></td> <td valign="top" width="312"> <p>15 min</p></td></tr></tbody></table> <p>If you’d like to manage advanced autoscale settings that aren’t possible to do in the Portal, you can also do that via the SDK. For example, you can construct autoscale based on custom metrics – you can autoscale by anything that is returned from MetricDefinitions. <p>All of the documentation on the SDK is available on <a href="http://go.microsoft.com/fwlink/?LinkID=331678&amp;clcid=0x409">MSDN</a>. <h2><u>API Management: Support for Services REST API</u></h2> <p>We launched the Azure API Management service into preview in May of this year.&nbsp; The API Management service enables&nbsp; customers to quickly and securely publish APIs to partners, the public development community, and even internal developers. <p>Today, I’m excited to announce the availability of the API Management REST API which opens up a large number of new scenarios. It can be used to manage APIs, products, subscriptions, users and groups in addition to accessing your API analytics. In fact, virtually any management operation available in the Management API Portal is now accessible programmatically - opening up a host of integration and automation scenarios, including directly monetizing an API with your commerce provider of choice, taking over user or subscription management, automating API deployments and more. <p>We've even provided an additional SAS (Shared Access Signature) security option. An integrated experience in the publisher portal allows you to generate SAS tokens - so securely calling your API service couldn’t be easier. In just three easy steps: <ol> <li>Enable the API on the System Settings page on the Publisher Portal <li><a href="http://go.microsoft.com/fwlink/?LinkId=507409">Acquire</a> a time-limited access token either manually or programmatically <li>Start sending requests to the API, providing the token with every request</li></ol> <p><a href="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_26.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_thumb_12.png" width="764" height="493"></a>&nbsp;</p> <p>See the REST API <a href="http://go.microsoft.com/fwlink/?LinkId=507408">reference</a> for full details. <h3><u>Delegation of user registration and product subscription</u></h3> <p>The new API Management REST API makes it easy to automate and integrate other processes with API management. Many customers integrating in this way already have a user account system and would prefer to use this existing resource, instead of the built-in functionality provided by the Developer Portal. This feature, called Delegation, enables your existing website or backend to own the user data, manage subscriptions and seamlessly integrate with API Management's dynamically generated API documentation. <p><a href="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_28.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="https://mscblogs.blob.core.windows.net/media/scottgu/WindowsLiveWriter/60d1c2bcce5c_1085A/image_thumb_13.png" width="766" height="364"></a> <p>It's easy to enable Delegation: in the Publisher Portal navigate to the Delegation section and enable Delegated Sign-in and Sign up, provide the endpoint URL and validation key and you're good to go. For more details, check out the <a href="http://go.microsoft.com/fwlink/?LinkID=507648">how-to guide</a>. <h2><u>Summary</u></h2> <p>Today’s Microsoft Azure release enables a ton of great new scenarios, and makes building applications hosted in the cloud even easier. <p>If you don’t already have a Azure account, you can sign-up for a <a href="https://www.windowsazure.com/en-us/pricing/free-trial/">free trial</a> and start using all of the above features today.&nbsp; Then visit the <a href="https://www.windowsazure.com/">Microsoft Azure Developer Center</a> to learn more about how to build apps with it. <p>Hope this helps, <p>Scott <p><em>P.S. In addition to blogging, I am also now using Twitter for quick updates and to share links. Follow me at:</em><a href="http://www.twitter.com/scottgu">twitter.com/scottgu</a> <img src="https://microsoftsto.112.2o7.net/b/ss/msstoaspnetblogs/1/H.19.4/s3342130146455?AQB=1&ndh=1&ns=microsoftsto&pageName=weblogs.asp.net/scottgu/azure-new-documentdb-nosql-service-new-search-service-new-sql-alwayson-vm-template-and-more&g=https%3A//weblogs.asp.net/scottgu/azure-new-documentdb-nosql-service-new-search-service-new-sql-alwayson-vm-template-and-more&r=https%3A//weblogs.asp.net/scottgu&cc=USD&ch=weblogs&server=weblogs.asp.net&events=event1&c1=asp.net&v1=asp.net&c2=en-us&v2=en-us&c3=ScottGu%27s%20Blog%20-%20Azure%3a+New+DocumentDB+NoSQL+Service%2c+New+Search+Service%2c+New+SQL+AlwaysOn+VM+Template%2c+and+more&v3=ScottGu%27s%20Blog%20-%20Azure%3a+New+DocumentDB+NoSQL+Service%2c+New+Search+Service%2c+New+SQL+AlwaysOn+VM+Template%2c+and+more&c4=weblogs%3A%20scottgu&v4=weblogs%3A%20scottgu&c5=scottgu&v5=scottgu&c10=https%3A//weblogs.asp.net/scottgu/azure-new-documentdb-nosql-service-new-search-service-new-sql-alwayson-vm-template-and-more&c14=RSS&v17=weblogs.asp.net/scottgu/azure-new-documentdb-nosql-service-new-search-service-new-sql-alwayson-vm-template-and-more&v44=37209679_03ca_403d_b3bc_299a962cf4ac&c45=fpc&v45=fpc&s=1920x1080&c=24&j=1.6&v=Y&k=Y&bw=1231&bh=214&p=&AQE=1&pid=weblogs.asp.net/scottgu" height="1" width="1" alt="omni" />